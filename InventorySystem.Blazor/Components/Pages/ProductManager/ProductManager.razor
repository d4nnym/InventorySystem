@page "/productmanager"
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@using InventorySystem.Blazor.Features.Categories.Components
@using InventorySystem.Blazor.Features.Brands.Components
@using InventorySystem.Blazor.Features.Models.Components
@using InventorySystem.Blazor.Components.Pages.ProductManager.Components
@inject ISnackbar Snackbar

<MudText Typo="Typo.h4" Class="mb-8">Product Manager</MudText>
<MudGrid Spacing="3" AlignItems="AlignItems.Stretch">
    <MudItem xs="12" md="4" xl="4" Class="d-flex">
        <MudPaper Class="pa-4 h-100 mud-width-full">
            <MudGrid>
                <MudItem xs="12">
                    <MudText Typo="Typo.h6">Categorías</MudText>
                </MudItem>
                <MudItem xs="12" Class="d-flex align-items-center gap-1">
                    <CategoryList @ref="_categoryList" @bind-SelectedCategoryId="CategoryId" />
                    <MudFab Color="@FabCategoryState.color" StartIcon="@FabCategoryState.icon" Size="Size.Small" @onclick="ToggleNewCategory" />
                </MudItem>
                @if (IsActiveNewCategory)
                {
                    <MudItem xs="12" Class="d-flex flex-column">
                        <MudTextField @bind-Value="_nameCategory" Label="Nueva Categoría" Variant="Variant.Outlined"></MudTextField>
                        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Info" Size="Size.Large" Class="top-0" @onclick="CreateCategory">Guardar</MudButton>
                    </MudItem>
                }

            </MudGrid>
            <MudDivider Class="my-4" Style="border: 1px solid gray" />
            <MudGrid>
                <MudItem xs="12">
                    <MudText Typo="Typo.h6">Marcas</MudText>
                </MudItem>
                <MudItem xs="12" Class="d-flex align-items-center gap-1">
                    <BrandList @ref="_brandList"  @bind-SelectedBrandId="BrandId" />
                    <MudFab Color="@FabBrandState.color" StartIcon="@FabBrandState.icon" Size="Size.Small" @onclick="ToggleNewBrand" />
                </MudItem>
                @if (IsActiveNewBrand)
                {
                    <MudItem xs="12" Class="d-flex flex-column">
                        <MudTextField @bind-Value="_nameBrand" Label="Nueva Marca" Variant="Variant.Outlined"></MudTextField>
                        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Info" Size="Size.Large" Class="top-0" @onclick="CreateBrand">Guardar</MudButton>
                    </MudItem>
                }
            </MudGrid>
        </MudPaper>
    </MudItem>

    <MudItem xs="12" md="8" xl="8" Class="d-flex">
        <MudPaper Class="pa-4 h-100 mud-width-full">

            <MudGrid>
                <MudItem xs="12">
                    <MudText Typo="Typo.h6">Agregar nuevo modelo</MudText>
                </MudItem>
                <MudItem xs="12">
                    <StatusIndicator Value="CategoryId" Label="Categoría" />
                    <StatusIndicator Value="BrandId" Label="Marca" />
                </MudItem>
                @if (CategoryId is not null && BrandId is not null)
                {
                    <MudItem xs="12">
                        <MudTextField @bind-Value="_nameModel" Label="Nuevo Modelo" Variant="Variant.Outlined"></MudTextField>
                    </MudItem>
                    <MudItem xs="12">
                        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Info" Size="Size.Large" Class="top-0" @onclick="CreateModel">Guardar</MudButton>
                    </MudItem>
                }
                else
                {
                    <MudItem xs="12">
                        <MudText Typo="Typo.body1">Seleccione una <b>Categoría</b> y una <b>Marca</b></MudText>
                    </MudItem>
                }
            </MudGrid>
        </MudPaper>
    </MudItem>
    <MudItem xs="12">
        <ProductModelTable @ref="_productModelTable"> </ProductModelTable>
    </MudItem>
</MudGrid>
@if (_error is not null)
{
    <MudAlert Severity="Severity.Error">@_error</MudAlert>
}
@code {

    private CategoryList? _categoryList;
    private BrandList? _brandList;
    private ProductModelTable? _productModelTable;

    private void ToggleNewCategory() => IsActiveNewCategory = !IsActiveNewCategory;
    private void ToggleNewBrand() => IsActiveNewBrand = !IsActiveNewBrand;

    // Se puede dejar en un solo pero determiné dejarlos separados por cuestiones de aprendizaje
    private (Color color, string icon) FabCategoryState =>
    IsActiveNewCategory
        ? (Color.Secondary, Icons.Material.Filled.Close)
        : (Color.Tertiary, Icons.Material.Filled.Add);

    private (Color color, string icon) FabBrandState =>
    IsActiveNewBrand
        ? (Color.Secondary, Icons.Material.Filled.Close)
        : (Color.Tertiary, Icons.Material.Filled.Add);

   
}